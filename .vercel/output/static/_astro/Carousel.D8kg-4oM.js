import{j as s}from"./jsx-runtime.BjG_zV1W.js";import{r as a}from"./index.C7o2Wufa.js";function A({issueNumber:c,date:b,pdfPath:x,thumbnail:g,position:m,itemWidth:w}){const[C,k]=a.useState(!1),f=Math.abs(m),l=Math.max(.7,1-f*.15),u=Math.max(.5,1-f*.2),W=Math.max(1,Math.round(1e4-f*500)),N=m*20,S=()=>{window.open(x,"_blank")};return s.jsxs("div",{className:"carousel-item",style:{transform:`scale(${l}) translateX(${N}px)`,opacity:u,zIndex:W,width:`${w}px`,flexShrink:0},onClick:S,children:[s.jsx("div",{className:"carousel-item-date",children:b}),s.jsx("div",{className:"carousel-item-inner",children:g&&!C?s.jsx("img",{src:g,alt:`Newsletter ${c}`,className:"carousel-item-image",onError:()=>k(!0)}):s.jsx("div",{className:"carousel-item-placeholder",children:s.jsx("svg",{className:"w-16 h-16 text-white opacity-30",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})})})}),s.jsx("div",{className:"carousel-item-number",children:c})]})}function P({nextDate:c,nextIssueNumber:b,position:x,itemWidth:g}){const m=Math.abs(x),w=Math.max(.7,1-m*.15),C=Math.max(.5,1-m*.2),k=Math.max(1,Math.round(1e4-m*500)),f=x*20;return s.jsxs("div",{className:"carousel-item placeholder-card",style:{transform:`scale(${w}) translateX(${f}px)`,opacity:C,zIndex:k,width:`${g}px`,flexShrink:0},children:[s.jsx("div",{className:"carousel-item-date",children:c}),s.jsx("div",{className:"carousel-item-inner placeholder-inner",children:s.jsx("div",{className:"placeholder-logo-container",children:s.jsx("img",{src:"/assets/images/curatedlogo.png",alt:"Curated Logo",className:"placeholder-logo"})})}),s.jsx("div",{className:"carousel-item-number",children:b})]})}function D({newsletters:c,nextDate:b,nextIssueNumber:x}){const[g,m]=a.useState({}),[w,C]=a.useState(!1),[k,f]=a.useState(!0),l=a.useRef(null),u=a.useRef(!1),W=a.useRef(null),[N,S]=a.useState({itemWidth:350,itemGap:40}),{itemWidth:d,itemGap:v}=N;a.useEffect(()=>{const e=async()=>{if(window.pdfjsLib){r();return}const t=document.createElement("script");t.src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js",t.onload=()=>{window.pdfjsLib&&(window.pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js",r())},t.onerror=()=>{console.warn("Failed to load PDF.js, thumbnails will not be generated")},document.head.appendChild(t)},r=async()=>{const t={};for(const n of c)try{const h=await(await window.pdfjsLib.getDocument(n.pdfPath).promise).getPage(1),j=h.getViewport({scale:1.5}),L=document.createElement("canvas"),R=L.getContext("2d");L.height=j.height,L.width=j.width,await h.render({canvasContext:R,viewport:j}).promise,t[n.issueNumber]=L.toDataURL("image/jpeg",.8)}catch(o){console.error(`Error generating thumbnail for ${n.issueNumber}:`,o)}m(t)};e()},[c]);const p=a.useCallback(e=>{if(!l.current)return 0;const t=d+v;return e*t},[d,v]),I=a.useCallback(()=>{const e=l.current;if(!e)return 0;const r=d+v,t=e.scrollLeft,n=Math.round(t/r),o=c.length+1;return Math.max(0,Math.min(o-1,n))},[d,v,c.length]),E=a.useCallback(()=>{const e=l.current;if(!e||u.current)return;const r=I(),t=p(r),n=e.scrollLeft;Math.abs(n-t)>5&&(u.current=!0,e.scrollTo({left:t,behavior:"smooth"}),setTimeout(()=>{u.current=!1},300))},[I,p]),M=a.useCallback(()=>{const e=l.current;if(!e)return;const r=e.scrollLeft,t=c.length+1,n=p(t-1),o=e.scrollWidth-e.clientWidth,i=Math.min(o,n+20);C(r>5),f(r<i-10)},[c.length,p]);a.useEffect(()=>{const e=()=>{const o=window.innerWidth<=768?{itemWidth:250,itemGap:20}:{itemWidth:350,itemGap:40};S(i=>i.itemWidth!==o.itemWidth||i.itemGap!==o.itemGap?o:i)};e();let r;const t=()=>{clearTimeout(r),r=setTimeout(e,150)};return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t),clearTimeout(r)}},[]),a.useEffect(()=>{const e=l.current;if(!e)return;const r=()=>{const n=e.querySelector(".carousel-track");e.scrollWidth>0&&e.clientWidth>0&&n&&n.offsetWidth>0?(e.scrollLeft=0,M()):requestAnimationFrame(r)},t=typeof window<"u"&&window.innerWidth<=768?50:0;t>0?setTimeout(()=>{requestAnimationFrame(r)},t):requestAnimationFrame(r)},[M,d,v]),a.useEffect(()=>{const e=l.current;if(!e)return;let r;const t=()=>{cancelAnimationFrame(r),r=requestAnimationFrame(()=>{M(),clearTimeout(W.current),W.current=setTimeout(()=>{u.current||E()},150)})};return e.addEventListener("scroll",t,{passive:!0}),()=>{e.removeEventListener("scroll",t),cancelAnimationFrame(r),clearTimeout(W.current)}},[M,E]),a.useEffect(()=>{const e=l.current;if(!e)return;const r=t=>{if(Math.abs(t.deltaY)>0&&!u.current){t.preventDefault();const n=I(),o=t.deltaY>0?1:-1,i=c.length+1,h=Math.max(0,Math.min(i-1,n+o));if(h!==n){const j=p(h);u.current=!0,e.scrollTo({left:j,behavior:"smooth"}),setTimeout(()=>{u.current=!1},400)}}};return e.addEventListener("wheel",r,{passive:!1}),()=>{e.removeEventListener("wheel",r)}},[I,p,c.length]);const T=e=>{const r=l.current;if(!r||u.current)return;const t=I(),n=c.length+1,o=e==="left"?Math.max(0,t-1):Math.min(n-1,t+1);if(o!==t){const i=p(o);u.current=!0,r.scrollTo({left:i,behavior:"smooth"}),setTimeout(()=>{u.current=!1},400)}},F=e=>{const r=l.current;if(!r||r.clientWidth===0)return 0;const t=d+v,n=r.clientWidth/2,o=r.clientWidth/2-d/2;return(e*t+d/2+o-r.scrollLeft-n)/t},[,y]=a.useState(0);return a.useEffect(()=>{const e=l.current;if(!e)return;let r,t=0;const n=()=>{const i=performance.now();if(i-t<16){cancelAnimationFrame(r),r=requestAnimationFrame(n);return}t=i,y(h=>h+1)},o=()=>{e.clientWidth>0?(e.addEventListener("scroll",n,{passive:!0}),window.addEventListener("resize",n),n()):requestAnimationFrame(o)};return o(),()=>{e.removeEventListener("scroll",n),window.removeEventListener("resize",n),cancelAnimationFrame(r)}},[]),s.jsxs("div",{className:"carousel-wrapper",children:[w&&s.jsx("button",{className:"carousel-nav-button carousel-nav-left",onClick:()=>T("left"),"aria-label":"Previous",children:s.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("path",{d:"M15 18l-6-6 6-6"})})}),s.jsx("div",{className:"carousel-container",ref:l,children:s.jsxs("div",{className:"carousel-track",children:[c.map((e,r)=>{const t=F(r);return s.jsx(A,{issueNumber:e.issueNumber,date:e.date,pdfPath:e.pdfPath,thumbnail:g[e.issueNumber],position:t,itemWidth:d},e.issueNumber)}),c.length>0&&s.jsx(P,{nextDate:b,nextIssueNumber:x,position:F(c.length),itemWidth:d})]})}),k&&s.jsx("button",{className:"carousel-nav-button carousel-nav-right",onClick:()=>T("right"),"aria-label":"Next",children:s.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("path",{d:"M9 18l6-6-6-6"})})})]})}export{D as default};
