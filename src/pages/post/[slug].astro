---
import { getEntryBySlug, getCollection } from "astro:content";
import PostLayout from "../../layouts/post.astro";

// Define the static paths for dynamic routes
export async function getStaticPaths() {
  const posts = await getCollection("post");
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { entry: post },
  }));
}

const { slug } = Astro.params;
const entry = await getEntryBySlug("post", slug);

if (!entry) {
  throw new Error(`Post not found: ${slug}`);
}

const { Content } = await entry.render();
const { title, description, date } = entry.data;

---
<PostLayout title={title} description={description} date={date}>
  <article class="prose dark:prose-invert mx-auto">
    <p class="text-gray-500 dark:text-gray-400 text-sm mb-6">
      {new Date(date).toLocaleDateString("en-US", {
        year: "numeric",
        month: "long",
        day: "numeric",
      })}
    </p>
    <Content />
  </article>
</PostLayout>